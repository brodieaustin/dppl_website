<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Library Card Application | DPPL</title>
	<link rel="stylesheet" href="leaflet/leaflet.css" />
	<!--[if lte IE 8]>
		<link rel="stylesheet" href="leaflet/leaflet.ie.css" />
	<![endif]-->
	<style>
		html{background-color: #eee;}
		body{width: 638px; padding: 5px; margin: 1em auto; background-color: #fff; border: 1px solid #c8c8c8; font-family: sans-serif; overflow-y: scroll;}
		h2{font-size: 100%; margin-top: .5em;}
		p{line-height: 1.5em;}
		.section{position: relative; min-height: 30%; padding: .5em 1em;}
		hr{clear: both; margin: 1em 0; border: 0; border-top: 1px solid #eee; height: 1px;}
		#map-wrapper{position: relative; width: 596px; min-height: 400px; margin: 1em 0; padding: 0; border: 5px solid #eee; background-color: #transparent;}
		#map{position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 50;}
		.button{display: inline-block; width: auto; height: 1.8em; line-height: 1.8em; padding: 0 1em; background-color: blue; border-radius: 5px; color: #fff; text-decoration: none; vertical-align: middle; text-align: center; cursor: pointer;}
		.button:hover{background-color: #c8c8c8; color: #333;}
		.right{ float: right;}
		form{width: 573px; margin-top: 1em; padding: 1em; border: 1px solid #c8c8c8; background-color: #fff;}
		form p{font-size: 90%;}
		form fieldset{margin-bottom: 1em; padding: 0; padding-bottom: 1em; border: 0; background-color: #fff; border-bottom: 1px solid #eee; }
		form fieldset div{clear: left; margin-bottom: .5em;}
		label, input, textarea, select{font-size: 90%; height: 1.5em; line-height: 1.5em; vertical-align: middle; outline: 0; border: 0; border: 1px solid #c8c8c8;}
		label{display: block; width: 22%; float: left; padding-right: .5em; border: 0;}
		label.wide{width: 100%;}
		input[type=text]{width: 50%;}
		input[type=text].wide{width: 80%;}
		input[type=radio]{margin-top: 0; vertical-align: top; margin-right: .5em;}
		input[type=button], input[type=submit]{border: 0;}
		.row{text-align: center;}
		.load{position: absolute; display: none; width: 100%;  height: 100%;  background: #fff url('../../images/ajax-loader.gif') no-repeat 50% 50%; z-index: 100;}
		.no-borders{border: 0;}
		.card-app{display: none;}
		.response{display: none; font-size: 90%;}
	</style>
</head>
<body>
	<div class="section no-borders" id="begin">
	<h1>Library Card Application</h1>
		<p>Thank you for applying for a DPPL library card. This form will help jump start your application process. We just have to determine if you are eligible for a card. After that, you will fill out and submit the application. Come to the library to pick up your card. That's it!</p>
		<div>
			<a href="#eligibility" class="button scroll right">Get started</a>
		</div>
	</div>
	<hr />
	<div class="section" id="eligibility">
		<h2>Step 1: Are you eligible?</h2>
		<form id="eligibility-form" class="no-borders">
			<div>
				<label for="eligibility-address">Enter your address:</label>
				<input type="text" id="eligibility-address" name="eligibility-address" style="min-width: 50%;" />
				<input type="submit" value="Check" id="submit-eligibility" name="submit-eligibility" class="button" />
			</div>
			<div class="response" id="eligibility-response"></div>
		</form>
		<div id="map-wrapper">
			<div class="load"></div>
			<div id="map"></div>
		</div>
		<div>
			<p>Is the marker inside the blue shape? If so, you can proceed with your application. Please note that library staff may still need to verify your address.</p>
			<div><a href="#application" class="button scroll right">Fill out application</a></div>
		</div>
	</div>
	<hr />
	<div class="section" id="application">
		<h2>Step 2: Complete the application</h2>
		<p>Select which form you would like to fill out below. Please note that a parent or guardian must be present to pick up a library card for a child</p>
		<p><em>This information is sent to library staff only and will not be shared with third parties</em></p>
		<div class="row">
			<a href="#application-adult" class="button show">Adult</a>
			<a href="#application-child" class="button show">Child</a>
		</div>
		<form id="application-adult" method=""  action="" class="card-app">
			<h3>Adult application</h3>
			<p>I apply for the right to use the library with all its rules and regulations, to give immediate notice of any changes of address or phone number and to abide by the rules of other libraries where I may use my library card.</p>
			<fieldset>
				<div>
					<label for="adult-last-name">Last Name</label>
					<input type="text" id="adult-last-name" name="adult-last-name" tabindex="1" />
				</div>
				<div>
					<label for="adult-first-name">First Name</label>
					<input type="text" id="adult-first-name" name="adult-first-name" tabindex="2" />
				</div>
				<div>
					<label for="adult-middle-initial">Middle Initial</label>
					<input type="text" id="adult-middle-initial" name="adult-middle-initial" tabindex="3" />
				</div>
				<fieldset>
					<div>
						<label for="adult-gender-male"><input type="radio" id="adult-gender-male" name="adult-gender" tabindex="4" />Male</label>
					</div>
					<div>
						<label for="adult-gender-female"><input type="radio" id="adult-gender-female" name="adult-gender" tabindex="5" />Female</label>
					</div>
				</fieldset>
				<div>
					<label for="adult-address">Address</label>
					<input type="text" id="adult-address" name="adult-address" tabindex="6" />
				</div>
				<div>
					<label for="adult-apartment">Apartment</label>
					<input type="text" id="adult-apartment" name="adult-apartment" tabindex="7" />
				</div>
				<div>
					<label for="adult-city">City</label>
					<input type="text" id="adult-city" name="adult-city" tabindex="8" />
				</div>
				<div>
					<label for="adult-zipcode">Zip</label>
					<input type="text" id="adult-zipcode" name="adult-zipcode" tabindex="9" />
				</div>
				<div>
					<label for="adult-home-phone">Phone</label>
					<input type="text" id="adult-home-phone" name="adult-home-phone" tabindex="10" />
				</div>
			</fieldset>
			<fieldset>
				<div>
					<label for="adult-employer">Employed by</label>
					<input type="text" id="adult-employer" name="adult-employer" tabindex="11" />
				</div>
				<div>
					<label for="adult-employer-address">Address</label>
					<input type="text" id="adult-employer-address" name="adult-employer-address" tabindex="12" />
				</div>
				<div>
					<label for="adult-employer-city">City</label>
					<input type="text" id="adult-employer-city" name="adult-employer-city" tabindex="13" />
				</div>
				<div>
					<label for="adult-employer-zip">Zip</label>
					<input type="text" id="adult-employer-zip" name="adult-employer-zip" tabindex="14" />
				</div>
				<div>
					<label for="adult-work-phone">Work</label>
					<input type="text" id="adult-work-phone" name="adult-work-phone" tabindex="15" />
				</div>
			</fieldset>
			<fieldset>
				<div>
					<label for="adult-drivers-license">Driver's License #</label>
					<input type="text" id="adult-drivers-license" name="adult-drivers-license" tabindex="16" />
				</div>
				<div>
					<label for="adult-date-of-birth">Date of Birth</label>
					<input type="text" id="adult-date-of-birth" name="adult-date-of-birth" tabindex="17" />
				</div>
				<div>
					<label for="adult-primary-language" class="wide">Primary Language Spoken at Home</label>
					<input type="text" id="adult-primary-language" name="adult-primary-language" tabindex="18" />
				</div>
			</fieldset>
			<fieldset>
				<div>
					<input type="submit" value="Submit" class="button right" />
				</div>
			</fieldset>
		</form>
		<form id="application-child" method=""  action="" class="card-app">
			<h3>Children's application</h3>
			<p>I apply for the right to use the library with all its rules and regulations, to give immediate notice of any changes of address or phone number and to abide by the rules of other libraries where I may use my library card.</p>
			<fieldset>
				<div>
					<label for="child-last-name">Last Name</label>
					<input type="text" id="child-last-name" name="child-last-name" tabindex="1" />
				</div>
				<div>
					<label for="child-first-name">First Name</label>
					<input type="text" id="child-first-name" name="child-first-name" tabindex="2" />
				</div>
				<div>
					<label for="child-middle-initial">Middle Initial</label>
					<input type="text" id="child-middle-initial" name="child-middle-initial" tabindex="3" />
				</div>
				<fieldset>
					<div>
						<label for="child-gender-male"><input type="radio" id="child-gender-male" name="child-gender" tabindex="4" />Male</label>
					</div>
					<div>
						<label for="child-gender-female"><input type="radio" id="child-gender-female" name="child-gender" tabindex="5" />Female</label>
					</div>
				</fieldset>
				<div>
					<label for="child-address">Address</label>
					<input type="text" id="child-address" name="child-address" tabindex="6" />
				</div>
				<div>
					<label for="child-apartment">Apartment</label>
					<input type="text" id="child-apartment" name="child-apartment" tabindex="7" />
				</div>
				<div>
					<label for="child-city">City</label>
					<input type="text" id="child-city" name="child-city" tabindex="8" />
				</div>
				<div>
					<label for="child-zipcode">Zip</label>
					<input type="text" id="child-zipcode" name="child-zipcode" tabindex="9" />
				</div>
				<div>
					<label for="child-home-phone">Phone</label>
					<input type="text" id="child-home-phone" name="child-home-phone" tabindex="10" />
				</div>
			</fieldset>
			<fieldset>
				<div>
					<label for="child-school">Employed by</label>
					<input type="text" id="child-school" name="child-school" tabindex="11" />
				</div>
				<div>
					<label for="child-grade">Address</label>
					<input type="text" id="child-grade" name="child-grade" tabindex="12" />
				</div>
				<div>
					<label for="child-date-of-birth">Date of Birth</label>
					<input type="text" id="child-date-of-birth" name="child-date-of-birth" tabindex="13" />
				</div>
				<div>
					<label for="child-primary-language" class="wide">Primary Language Spoken at Home</label>
					<input type="text" id="child-primary-language" name="child-primary-language" tabindex="14" />
				</div>
			</fieldset>
			<fieldset>
				<p>I am aware there are no age restrictions on borrowing library material and I accept the responsiblity for my child's selection of materials.</p>
				<div>
					<label for="child-parent-name" class="wide">Parent's Printed Name</label>
					<input type="text" id="child-parent-name" name="child-parent-name" tabindex="15" />
				</div>
				<div>
					<label for="child-parent-drivers-license" class="wide">Driver's License #</label>
					<input type="text" id="child-parent-drivers-license" name="child-parent-drivers-license" tabindex="16" />
				</div>
			</fieldset>
			<fieldset>
				<div>
					<input type="submit" value="Submit" class="button right" />
				</div>
			</fieldset>
		</form>
		<div class="response" id="application-response"></div>
	</div>
	<hr />
	<div class="section no-borders" id="end">
		<p class="response" id="application-response"></p>
	</div>
	<script src="../../js/jquery-1.7.1.min.js"></script>
	<script src="leaflet/leaflet.js"></script>
	<script src="http://maps.stamen.com/js/tile.stamen.js"></script>
	<script>

		$(document).ready(function(){
			var height = $(window).height();
			$('.section').height(height);
			$('#eligibility-form').submit(function(){
				$('#eligibility-response').empty().hide();
				$('.load').fadeIn('500');
				var address = $('#eligibility-address').val();
				
				var url = 'http://nominatim.openstreetmap.org/search?q=' + address + '&format=json&addressdetails=1';
				
				$.getJSON(url, function(data){
					if (data.length != 0){
						console.log(data[0]);
						addMarker(data[0].lat, data[0].lon);
					}
					else{
					 $('#eligibility-response').html('Sorry, that location was not found').css('color', 'red').show();
					}
					$('.load').fadeOut('500');
				
				});
				
				
				return false;
			});
			
			$('.scroll').click(function(event){		
				event.preventDefault();
				$('html,body').animate({scrollTop:$(this.hash).offset().top}, 500);
			});
			
			$('.show').bind('click', function(){
				$('.card-app').hide();
				var id = $(this).attr('href');
				$(id).fadeIn('500');
				
				return false;
			});
			
			// initialize the map on the "map" div
		var map = new L.Map('map');

		// create a CloudMade tile layer (or use other provider of your choice)
		var cloudmade = new L.TileLayer('http://{s}.tile.cloudmade.com/009e38ae4f16468b82a353bc9accf305/1714/256/{z}/{x}/{y}.png', {
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>',
			maxZoom: 16
		});

		// add the CloudMade layer to the map set the view to a given center and zoom
		map.addLayer(cloudmade).setView(new L.LatLng(42.033889, -87.899722), 12);
		
		//set up coordinates for DP shape
		var p1 = new L.LatLng(42.080, -87.893),
			p2 = new L.LatLng(42.081, -87.907),
			p3 = new L.LatLng(42.066, -87.907),
			p4 = new L.LatLng(42.066, -87.921),
			p5 = new L.LatLng(42.049, -87.921),
			p6 = new L.LatLng(42.048, -87.940),
			p7 = new L.LatLng(42.009, -87.940),
			p8 = new L.LatLng(42.010, -87.885),
			p9 = new L.LatLng(41.999, -87.884),
			p10 = new L.LatLng(41.996, -87.873),
			p11 = new L.LatLng(41.996, -87.863),
			p12 = new L.LatLng(42.039, -87.869),
			p13 = new L.LatLng(42.053, -87.869),
			p14 = new L.LatLng(42.055, -87.888),
			polygonPoints = [p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, p12, p13, p14];

		var polygon = new L.Polygon(polygonPoints);
		map.addLayer(polygon);

		var marker = new L.Marker();
		
		function addMarker(lat, lng){
			map.closePopup();
			
			console.log(lat, lng);
			
			var latlng = new L.LatLng(lat, lng, name);
			
			marker.setLatLng(latlng);
			
			marker.addTo(map)
			map.setView(latlng, 12);
		};
			
		});
	</script>
</body>
</html>
